---
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import Divider from '../components/Divider.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts', ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6);
---

<BaseLayout title="Home" description="The Bitcoin Breakdown - Your guide to understanding Bitcoin. Clear explanations, no hype, no jargon.">
  <!-- Hero -->
  <section class="hero">
    <div class="hero-hash hash-decoration" aria-hidden="true" id="heroHash">
      0xf4a7c3d8e1b905263f8c7d4a2e1b0f9d3c8a7e6b
    </div>

    <p class="hero-overline">Education &middot; Clarity &middot; Sovereignty</p>

    <h1 class="hero-title">
      Understand Bitcoin.<br />
      Not the <em class="glitch" data-text="noise.">noise.</em>
    </h1>

    <p class="hero-body">
      Clear, honest explanations about Bitcoin and cryptocurrency.
      No jargon. No hype. Just signal.
    </p>

    <div class="hero-cta-group">
      <a href="/blog" class="btn btn--primary tbb-link">Start Learning</a>
      <a href="/blog" class="btn btn--ghost tbb-link">Latest Articles</a>
    </div>

    <div class="block-height" id="blockHeight" aria-hidden="true">
      BLOCK #883,241
    </div>

    <div class="scroll-indicator" aria-hidden="true">
      <span>Scroll</span>
      <div class="line"></div>
    </div>
  </section>

  <Divider />

  <!-- Recent Articles -->
  <section class="articles-section section">
    <div class="container--wide">
      <div class="section-label">Latest Articles</div>

      {recentPosts.length > 0 ? (
        <div class="card-grid stagger">
          {recentPosts.map((post) => (
            <div class="reveal">
              <PostCard
                title={post.data.title}
                description={post.data.description}
                pubDate={post.data.pubDate}
                slug={post.id}
                tags={post.data.tags}
                image={post.data.image}
              />
            </div>
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <div class="empty-icon">&#8383;</div>
          <h3 class="empty-title">No blocks mined yet</h3>
          <p class="empty-desc">Articles are on the way. Check back soon.</p>
        </div>
      )}

      {recentPosts.length > 0 && (
        <div class="view-all">
          <a href="/blog" class="link-standalone tbb-link">View all articles</a>
        </div>
      )}
    </div>
  </section>
</BaseLayout>

<style>
  /* Hero */
  .hero {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: var(--space-10) var(--page-margin);
    position: relative;
  }

  .hero::before {
    content: '';
    position: absolute;
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.05), transparent 70%);
    pointer-events: none;
    animation: heroPulse 6s ease-in-out infinite;
  }

  .hero-hash {
    margin-bottom: var(--space-5);
    max-width: 90vw;
  }

  .hero-overline {
    font-size: 11px;
    letter-spacing: 6px;
    text-transform: uppercase;
    color: var(--gold-muted);
    margin-bottom: var(--space-5);
    font-weight: 400;
  }

  .hero-title {
    font-size: clamp(36px, 7vw, 72px);
    font-weight: 300;
    line-height: 1.08;
    letter-spacing: 1px;
    color: var(--text-primary);
    margin-bottom: var(--space-4);
    max-width: 800px;
  }

  .hero-title em {
    font-style: italic;
    color: var(--gold);
    text-shadow: 0 0 40px var(--gold-glow), 0 0 80px rgba(255, 215, 0, 0.12);
  }

  .hero-body {
    font-size: 18px;
    font-weight: 300;
    color: var(--text-secondary);
    max-width: 520px;
    line-height: 1.75;
    margin-bottom: var(--space-6);
  }

  .hero-cta-group {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
    justify-content: center;
    padding-top: 4px;
  }

  .block-height {
    position: absolute;
    bottom: 100px;
    left: var(--page-margin);
  }

  .scroll-indicator {
    position: absolute;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
    opacity: 0.35;
    animation: scrollBob 2s ease-in-out infinite;
  }

  .scroll-indicator span {
    font-size: 10px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--text-muted);
  }

  .scroll-indicator .line {
    width: 1px;
    height: 32px;
    background: linear-gradient(to bottom, var(--gold-muted), transparent);
  }

  /* Articles section */
  .articles-section {
    padding-bottom: var(--space-9);
  }

  .view-all {
    text-align: center;
    margin-top: var(--space-6);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .hero {
      min-height: 90vh;
    }

    .hero-cta-group {
      flex-direction: column;
      align-items: center;
    }

    .hero-cta-group .btn {
      width: 100%;
      max-width: 280px;
      text-align: center;
    }

    .block-height {
      display: none;
    }
  }
</style>
