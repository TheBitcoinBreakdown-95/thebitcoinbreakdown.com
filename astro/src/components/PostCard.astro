---
interface Props {
  title: string;
  description: string;
  pubDate: Date;
  slug: string;
  tags?: string[];
  image?: string;
}

const { title, description, pubDate, slug, tags = [], image } = Astro.props;

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
};

// Generate a deterministic hash-like string from the title
const hashString = Array.from(title)
  .reduce((acc, char) => ((acc << 5) - acc + char.charCodeAt(0)) | 0, 0)
  .toString(16)
  .replace('-', '')
  .padStart(8, '0')
  .slice(0, 8);
---

<article class="article-card">
  <a href={`/blog/${slug}`} class="card-link">
    <div class="card-glow" aria-hidden="true"></div>
    {tags.length > 0 && (
      <span class="card-tag">{tags[0]}</span>
    )}
    <h2 class="card-title scramble-text" data-original={title}>{title}</h2>
    <p class="card-excerpt">{description}</p>
    <div class="card-meta">
      <time datetime={pubDate.toISOString()}>{formatDate(pubDate)}</time>
    </div>
    <div class="card-hash" aria-hidden="true">0x{hashString}...{hashString.split('').reverse().join('')}</div>
    <div class="card-underline" aria-hidden="true"></div>
  </a>
</article>

<style>
  .article-card {
    background: var(--black-card);
    border: 1px solid transparent;
    padding: 0;
    transition: transform 0.5s var(--ease-luxury), box-shadow 0.5s var(--ease-luxury);
    position: relative;
    overflow: visible;
  }

  /* Laser trace border */
  .article-card::before {
    content: '';
    position: absolute;
    inset: -1px;
    background: linear-gradient(90deg, var(--gold), var(--gold-muted), var(--gold));
    background-size: 400% 400%;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.5s ease;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask-composite: xor;
    padding: 1px;
  }

  .article-card:hover::before {
    opacity: 1;
    animation: laserTrace 1.5s linear infinite;
  }

  .article-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5);
  }

  .card-link {
    display: block;
    padding: var(--space-5) var(--space-4);
    text-decoration: none;
    color: inherit;
    position: relative;
  }

  .card-link:hover {
    text-shadow: none;
  }

  /* Ambient glow */
  .card-glow {
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: radial-gradient(ellipse at 50% 0%, var(--gold-overlay), transparent 70%);
    opacity: 0;
    transition: opacity 0.5s ease;
  }

  .article-card:hover .card-glow {
    opacity: 1;
  }

  /* Gold underline at bottom */
  .card-underline {
    position: absolute;
    bottom: 0;
    left: var(--space-4);
    right: var(--space-4);
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .article-card:hover .card-underline {
    opacity: 0.3;
  }

  .card-tag {
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gold-muted);
    margin-bottom: var(--space-2);
    font-weight: 400;
    position: relative;
    z-index: 1;
    display: block;
  }

  .card-title {
    font-family: var(--font);
    font-size: 22px;
    font-weight: 400;
    color: var(--text-primary);
    line-height: 1.35;
    margin-bottom: var(--space-2);
    position: relative;
    z-index: 1;
    transition: color 0.3s ease;
    letter-spacing: 0.3px;
  }

  .article-card:hover .card-title {
    color: var(--gold);
  }

  .card-excerpt {
    font-size: 14px;
    font-weight: 300;
    color: var(--text-muted);
    line-height: 1.65;
    position: relative;
    z-index: 1;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-meta {
    margin-top: var(--space-3);
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--text-muted);
    position: relative;
    z-index: 1;
    font-weight: 300;
  }

  .card-hash {
    font-family: var(--font-mono);
    font-size: 8px;
    font-weight: 300;
    color: var(--text-muted);
    opacity: 0.15;
    margin-top: var(--space-3);
    letter-spacing: 1px;
    position: relative;
    z-index: 1;
    user-select: none;
  }
</style>
